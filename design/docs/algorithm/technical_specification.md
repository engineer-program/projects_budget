# Наименование проекта

Плагин для учёта финансов по проектам и сотрудникам компании

## Цель проекта

Реализовать плагин для Easy Redmine для учёта финансов по проектам и сотрудникам компании

## Исходная информация

* веб-приложение системы контроля и управления проектами Easy Redmine 2018.1.1;
* база данных MySQL 5.7.

## Что нужно сделать

Реализация полноценного финансового плагина. Доступ к основным настройкам и просмотру информации в отдельной вкладке "Финансы" в меню "Прочее" в веб-версии Easy Redmine. Необходимо предусмотреть наличие доступа в зависимости от роли пользователя.
Должно открываться главное окно (З/П и премии сотрудников), где справа сверху будет несколько кнопок, при нажатии на которые будет открываться соответствующее окно:

* З/П и премии сотрудников (оно же главное окно);
* финансы проектов;
* сводка финансов;
* статистика.

### Страница "З/П и премии сотрудников"

Представляет собой [страницу](https://www.figma.com/design/InItq3Ywyfz5n2juZiQldq/Finance-projects-Redmine-Plugin?node-id=16-196&m=dev&t=bG8mUnVZt1Aa8s0Z-1) с информацией в табличном виде, где показываются реальные (расчётные) заработные платы и премии по сотрудникам.
В таблице можно:

* фильтровать значения по месяцам (диапазон по умолчанию - текущий календарный год);
* фильтровать и сортировать значения списка сотрудников (по умолчанию, сортировка в алфавитном порядке по фамилии сотрудника, фильтр - участники группы "ТКЗ ИЦ СПб"):
  * фамилии;
  * имени;
  * должности;
  * группа;
* выбрать какие столбцы атрибутов "Проектов" будут показываться в таблице (Номер проекта, Проект, Наименование в 1С и т.п.).

Сама таблица на этой странице является нередактируемой.
![Таблица з/п и премий сотрудников](/docs/table_salaries_bonuses_employees.png)
Значения в таблице з/п сотрудника являются расчётными:

* для сотрудников на полной ставке - реальная указанная з/п на руки за месяц вне зависимости от отработанных часов;
* для сотрудников на неполной ставке - посчитанная з/п на руки за месяц с учётом отработанных часов, она рассчитывается таким образом: з/п (ставка) на руки делится на кол-во рабочих часов в месяце и умножается на кол-во отработанных часов за этот месяц.

Значения премий сотрудников отображаются ровно такими, какими их вводят на другой странице (о ней ниже).
Последним столбцом в таблице является средний доход сотрудника в месяц за показываемый период времени, который автоматически рассчитывается: сумма всех реальных з/п и премий за этот промежуток разделить на кол-во месяцев данного временного промежутка.
Внизу справа есть кнопки экспорта данной таблицы в формате csv, xlsx.

Для этой страницы дополнительно справа есть кнопка:

* Редактировать таблицу З/П и премий.

При нажатии на кнопку "Редактировать таблицу З/П и премий" открывается [страница "Номинальные заработные платы и премии сотрудников на руки"](https://www.figma.com/design/InItq3Ywyfz5n2juZiQldq/Finance-projects-Redmine-Plugin?node-id=169-2).

### Страница "Номинальные заработные платы и премии сотрудников на руки"

Данная страница уже представляет собой редактируемую таблицу з/п на руки в месяц и премий на руки за месяц.
Фильтры и сортировки в таблице сохраняются как на предыдущей странице; есть возможность их изменения.
Каждое значение з/п и премии можно редактировать вручную.
Однако в таблице значения з/п по месяцам заполняются автоматически, когда наступает каждый новый месяц. Например, на момент 31 января в таблице заполнена з/п за январь; при наступлении 1 февраля последняя указанная сумма з/п сотрудника за январь месяц автоматически записывается на з/п за февраль.
![Редактируемая таблица з/п и премий сотрудников](/docs/edit_table_salaries_bonuses_employees.png)
Столбец "Средний доход за данный период" отсутствует.
Значения з/п для тех, кто на полной ставке и на неполной ставке, указываются такие, словно сотрудник работает на полной ставке.
Для этой страницы дополнительно справа есть кнопка:

* Сохранить.

Внизу справа есть кнопки экспорта данной таблицы в формате csv, xlsx.

### Страница "Финансы проектов"

Представляет собой [страницу](https://www.figma.com/design/InItq3Ywyfz5n2juZiQldq/Finance-projects-Redmine-Plugin?node-id=48-2) с информацией в табличном виде, где показываются данные бюджетов проектов и их подпроектов.
Все значения в данной таблице являются нередактируемыми.
Первые столбцы являются атрибутами "Проектов", например, "Номер проекта", "Проект".
Далее идёт столбец под названием "Стартовый бюджет", который является стартовым бюджетом проекта на старте этого проекта.
Последующие столбцы идут по 3 штуки на каждый месяц:

* Бюджет на начало месяца - вычисляется автоматически: $$Budget + Total\_incomes - Total\_expenses,$$ где $Budget$ - стартовый бюджет проекта; $Total\_incomes$ - сумма всех иных доходов проекта на момент начала данного месяца; $Total\_expenses$ - сумма всех трат проекта на момент начала данного месяца;
* Расходы на з/п сотрудников - вычисляется автоматически сумма расходов на з/п сотрудников, которые имеют затраченное время на проекте в данном месяце:
  * для сотрудников на полной ставке по формуле: $$\frac{Salary \cdot Hours_{project\_month}}{Hours_{month}},$$ где $Salary$ - полная з/п сотрудника; $Hours_{project\_month}$ - кол-во отработанных часов сотрудника за данный месяц на проекте; $Hours_{month}$ - кол-во отработанных часов сотрудника за данный месяц;
  * для сотрудников на неполной ставке по формуле: $$\frac{Salary \cdot Hours_{project\_month}}{Normal\_hours_{month}},$$ где $Salary$ - полная з/п сотрудника, которая вносится на странице "Номинальные заработные платы и премии сотрудников на руки"; $Hours_{project\_month}$ - кол-во отработанных часов сотрудника за данный месяц на проекте; $Normal\_hours_{month}$ - кол-во рабочих часов за данный месяц для 40 ч. недели согласно производственному календарю;
* Расходы на премии сотрудников - кол-во расходов в месяце данного проекта на выделение премий сотрудникам; задаваётся вручную на странице "Редактирование финансов проектов".

Последний столбец "Остаток бюджета" является значением остатка бюджета проекта на конец выбранного временного диапазона, т.е. на конец последнего месяца во временном диапазоне.

В таблице можно:

* отфильтровать по месяцам (диапазон по умолчанию - текущий календарный год);
* упорядочить значения списка проектов и отфильтровать список проектов и подпроектов;
* выбрать какие столбцы атрибутов "Проектов" будут показываться в таблице (Номер проекта, Проект, Наименование в 1С и т.п.).
В таблице отображаются как отдельные проекты, так и проекты с подпроектами (подпроекты вложены в родительский проект).

Правила для проектов (родительских проектов) с подпроектами:

* сгруппированы вместе;
* значения столбцов "Стартовый бюджет", "Бюджет на начало месяца", "Расходы на з/п сотрудников" и др. для строки родительского проекта получаются суммированием соответствующих значений строк подпроектов данного родительского проекта.

Для этой страницы дополнительно справа есть кнопки:

* Редактировать финансы проектов;
* Добавить доход в бюджет проекта;
* Добавить расход бюджета проекта.

Внизу справа есть кнопки экспорта данной таблицы в формате csv, xlsx.

При нажатии на кнопку "Редактировать финансы проектов" открывается [страница "Редактирование финансов проектов"](https://www.figma.com/design/InItq3Ywyfz5n2juZiQldq/Finance-projects-Redmine-Plugin?node-id=191-14).

На странице "Редактирование финансов проектов" часть значений в таблице можно редактировать, а именно столбцы "Расходы на премии сотрудников".
Справа появляется дополнительная кнопка "Сохранить".

При нажатии на кнопку "Добавить доход в бюджет проекта" поверх открывается всплывающее окно (тут будет ссылка), в котором можно внести дополнительный доход в бюджет проекта. Для этого в появившемся окне есть следующие поля:

* дата выделения статьи дохода проекта - обязательное поле;
* выбор проекта, бюджет которого пополняем - обязательное поле;
* в описании можно оставить комментарий - обязательное поле;
* сумма дохода - обязательное поле.

При нажатии на кнопку "Добавить расход бюджета проекта" поверх открывается всплывающее окно (тут будет ссылка), в котором можно внести дополнительный расход бюджета проекта. Для этого в появившемся окне есть следующие поля:

* дата выделения статьи расхода бюджета проекта - обязательное поле;
* выбор проекта, из бюджета которого вычитаем расход - обязательное поле;
* в описании можно оставить комментарий - обязательное поле;
* сумма расхода - обязательное поле.

### Страница "Сводка финансов"

В разработке..

### Страница "Статистика"

В разработке..
